<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PSMC Tokyo Business trip</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&family=Noto+Sans+TC:wght@400;500;700&display=swap" rel="stylesheet">
    
    <!-- Chosen Palette: Brilliant Blues (Based on provided style: #05445E, #189AB4, #75E6DA, #D4F1F4) -->
    <!-- Application Structure Plan: Dashboard approach with static core analysis and a tabbed navigation for daily schedules. Each daily tab features a vertical timeline for itinerary details, a dedicated "Action Items" card for critical tasks/costs, and a time distribution chart. This structure separates core analysis from daily execution details and provides a focused, actionable view for the user. -->
    <!-- Visualization & Content Choices: Time Distribution (Goal: Organize/Inform, Method: Doughnut Chart - Chart.js) provides an intuitive breakdown of activity vs. transit time. Action Items (Goal: Inform/Organize, Method: HTML Card/List) are high-priority text blocks for immediate visibility. Timeline (Goal: Change, Method: HTML/CSS) presents chronological flow clearly. NO SVG/Mermaid. -->
    <!-- CONFIRMATION: NO SVG graphics used. NO Mermaid JS used. -->
    
    <style>
        body {
            font-family: 'Inter', 'Noto Sans TC', sans-serif;
            background-color: #f8fafc; 
        }
        
        .chart-container {
            position: relative;
            width: 100%;
            max-width: 600px;
            margin-left: auto;
            margin-right: auto;
            height: 350px; /* å¢åŠ é«˜åº¦ä»¥å®¹ç´åœ“é¤…åœ–å’Œåœ–ä¾‹ */
            max-height: 400px;
            box-sizing: border-box;
        }

        .chart-container canvas {
            width: 100% !important;
            height: 100% !important;
        }

        @media (min-width: 768px) {
            .chart-container {
                height: 350px;
                max-height: 400px;
            }
        }

        /* Mobile: reduce chart height and give tab content extra bottom space so the chart/legend won't collide with bottom buttons */
        @media (max-width: 640px) {
            .chart-container {
                height: 240px !important; /* è®“åœ“é¤…åœ–è®Šå°ï¼Œé¿å…èˆ‡é é¢åº•éƒ¨è¡çª */
                max-height: 320px !important;
            }
            .tab-content {
                padding-bottom: calc(env(safe-area-inset-bottom, 0px) + 3.5rem); /* å¢åŠ åº•éƒ¨ç©ºé–“ï¼ˆå¯èª¿ï¼‰ï¼ŒåŒæ™‚å°Šé‡å®‰å…¨å€åŸŸ */
            }
            /* å¯é¸ï¼šè®“åœ–ä¾‹ç½®åº•ä¸¦ç½®ä¸­ï¼Œç¯€çœå·¦å³ç©ºé–“ */
            .chart-legend-bottom {
                display: flex;
                justify-content: center;
                flex-wrap: wrap;
                gap: 0.5rem 0.75rem;
                margin-top: 0.5rem;
                text-align: center;
                padding-bottom: calc(env(safe-area-inset-bottom, 0px) + 0.5rem);
            }
        }

        .chart-legend-bottom .legend-item {
            display: inline-flex;
            align-items: center;
            gap: 0.4rem;
            background: rgba(255,255,255,0.9);
            padding: 0.25rem 0.5rem;
            border-radius: 999px;
            font-size: 0.85rem;
            color: #183B56;
            box-shadow: 0 1px 2px rgba(0,0,0,0.06);
        }

        .chart-legend-bottom .legend-box {
            display:inline-block;
            width: 10px;
            height: 10px;
            border-radius: 2px;
            flex-shrink: 0;
        }
        
        .timeline-item {
            display: flex;
            position: relative;
        }
        .timeline-connector {
            position: absolute;
            left: 32px; 
            top: 32px; 
            bottom: 0;
            width: 2px;
            background-color: #189AB4; 
        }
        .timeline-dot {
            /* ç¢ºä¿æ­£åœ“å½¢ (65px x 65px) */
            width: 65px;
            height: 65px; 
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            background-color: #05445E;
            color: white;
            font-weight: 700;
            z-index: 10;
            border: 4px solid #D4F1F4;
            font-size: 0.85rem;
            flex-shrink: 0; 
        }
        .timeline-content {
            padding-left: 1.25rem;
            padding-bottom: 1.5rem;
            width: 100%;
        }
        .timeline-item:last-child .timeline-connector {
            display: none;
        }
        
        .tab-btn {
            /* å¢åŠ  padding é¿å…æˆªæ–· */
            padding: 0.75rem 1.5rem; 
            font-size: 0.875rem;
            font-weight: 600;
            border-radius: 0.5rem;
            cursor: pointer;
            transition: all 0.3s ease;
            color: #05445E;
            background-color: #D4F1F4;
            white-space: nowrap; 
        }
        .tab-btn.active {
            color: white;
            background-color: #05445E;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
        }

        /* åœ°éµç·šè·¯ä»£è¡¨è‰² */
        .line-jr { color: #8BC34A; font-weight: 600; }
        .line-marunouchi { color: #F44336; font-weight: 600; }
        .line-ginza { color: #FF9900; font-weight: 600; }
        .line-fukutoshin { color: #9c5e31; font-weight: 600; }
        .line-oedo { color: #b6007a; font-weight: 600; }
        .line-skyliner { color: #004d9c; font-weight: 600; } 
    </style>
</head>
<body class="bg-gray-50">

    <div class="container mx-auto p-4 md:p-8 max-w-7xl">
        
        
        <header class="text-center mb-8 md:mb-12">
            <h1 class="text-4xl md:text-5xl font-bold text-[#05445E] mb-2">PSMC Tokyo Business trip</h1>
            <p class="text-lg md:text-xl text-[#189AB4]">v8: åœ–ä¾‹ä¿®æ­£èˆ‡è³‡è¨Šçµæ§‹å„ªåŒ–</p>
        </header>

        
        <section class="mb-8 md:mb-12">
            <h2 class="text-2xl font-bold text-[#05445E] mb-6 text-center">æ ¸å¿ƒæ•¸æ“šåˆ†æ (ä½å®¿èˆ‡äº¤é€šå„ªå‹¢)</h2>
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                
                <div class="bg-white p-6 rounded-lg shadow-lg border-l-4 border-[#189AB4] lg:col-span-3">
                    <h3 class="text-xl font-semibold text-[#05445E] mb-3">é—œéµç™¼ç¾ï¼šAirbnb æ­¥è¡Œæ™‚é–“</h3>
                    <p class="text-gray-700 mb-4">Airbnb åœ°å€ (6-chÅme-4-19 Shinjuku) çš„äº¤é€šå„ªå‹¢ï¼Œè®“æ‚¨å¯åˆ©ç”¨å¤šæ¢åœ°éµç·šè·¯ï¼š</p>
                    <div class="grid grid-cols-1 sm:grid-cols-3 gap-4">
                        <div class="flex items-start">
                            <span class="text-2xl mr-3 mt-0.5">ğŸš¶</span>
                            <div>
                                <strong class="text-[#05445E] block">3-5 åˆ†é˜ æ­¥è¡Œ</strong>
                                <span class="font-semibold text-[#189AB4]">æ±æ–°å®¿ç«™ (éƒ½ç‡Ÿå¤§æ±Ÿæˆ¶ç·š)</span>
                            </div>
                        </div>
                        <div class="flex items-start">
                            <span class="text-2xl mr-3 mt-0.5">ğŸš¶</span>
                            <div>
                                <strong class="text-[#05445E] block">8-10 åˆ†é˜ æ­¥è¡Œ</strong>
                                <span class="font-semibold text-[#189AB4]">æ–°å®¿ä¸‰ä¸ç›®ç«™ (Metro)</span>
                            </div>
                        </div>
                        <div class="flex items-start">
                            <span class="text-2xl mr-3 mt-0.5">ğŸš¶</span>
                            <div>
                                <strong class="text-[#05445E] block">12-15 åˆ†é˜ æ­¥è¡Œ</strong>
                                <span class="font-semibold text-gray-600">JR æ–°å®¿ç«™ (æ±å£)</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        
        <section>
            <h2 class="text-2xl font-bold text-[#05445E] mb-6 text-center">5æ—¥å®Œæ•´è¡Œç¨‹è¦–è¦ºåŒ– (Bç‰ˆ)</h2>
            
            
            <div class="flex flex-wrap justify-center gap-2 md:gap-4 mb-6" id="tabs-container">
                <button class="tab-btn active" data-tab="day1">Day 1: æŠµé” & æ–°å®¿</button>
                <button class="tab-btn" data-tab="day2">Day 2: æ·ºè‰ & ç§‹è‘‰åŸ</button>
                <button class="tab-btn" data-tab="day3">Day 3: åŸå®¿ & æ¾€è°·æ—¥è½</button>
                <button class="tab-btn" data-tab="day4">Day 4: éµå¡” & å…­æœ¬æœ¨</button>
                <button class="tab-btn" data-tab="day5">Day 5: ç¯‰åœ° & è¿”ç¨‹</button>
            </div>

            
            <div class="space-y-8">
                
                <div id="day1" class="tab-content bg-white p-6 md:p-8 rounded-lg shadow-lg">
                    <h3 class="text-2xl font-bold text-[#05445E] mb-4 border-b-2 border-[#189AB4] pb-2">12/17 (ä¸‰) - Day 1: æŠµé” & æ–°å®¿</h3>
                    
                    <div class="bg-[#D4F1F4] p-4 rounded-lg mb-6 shadow-inner">
                        <h4 class="font-bold text-lg text-[#05445E] mb-2">â­ ç•¶æ—¥å¾…è™•ç†äº‹é …/æé†’</h4>
                        <div class="grid grid-cols-1 sm:grid-cols-2 gap-x-4 gap-y-2 text-gray-700 ml-4">
                            <div>
                                <strong class="text-[#05445E] block mb-1">é è¨‚ & è²»ç”¨</strong>
                                <ul class="list-disc list-inside space-y-1 ml-4 text-sm">
                                    <li>Skyliner è»Šç¥¨ (ç´„ Â¥4500)</li>
                                    <li>åˆé¤ï¼šé‡‘è‰²ä¸å¦‚æ­¸ï¼Œéœ€é ç•™æ’éšŠæ™‚é–“ã€‚</li>
                                </ul>
                            </div>
                            <div>
                                <strong class="text-[#05445E] block mb-1">è·¯ç·š & æé†’</strong>
                                <ul class="list-disc list-inside space-y-1 ml-4 text-sm">
                                    <li>æ™¯é»æé†’: æ–°å®¿å¾¡è‹‘ 16:30 æœ€å¾Œå…¥å ´ï¼Œè«‹æŒæ¡æ™‚é–“ã€‚</li>
                                </ul>
                            </div>
                        </div>
                    </div>

                    <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                        <div class="md:col-span-2">
                            <div class="timeline-item">
                                <div class="timeline-connector"></div>
                                <div class="timeline-dot">10:40</div>
                                <div class="timeline-content">
                                    <h4 class="font-semibold text-lg text-gray-800">æŠµé”æˆç”° (T1) & å…¥å¢ƒ</h4>
                                    <p class="text-gray-600">èˆªç­ TR898ã€‚é ä¼° 1 å°æ™‚å®Œæˆæ‰‹çºŒã€‚</p>
                                </div>
                            </div>
                            <div class="timeline-item">
                                <div class="timeline-connector"></div>
                                <div class="timeline-dot">11:40</div>
                                <div class="timeline-content">
                                    <h4 class="font-semibold text-lg text-gray-800">å‰å¾€è»Šç«™è³¼ç¥¨</h4>
                                    <p class="text-gray-600">T1 åœ°ä¸‹ B1F è³¼è²· Skyliner è»Šç¥¨ã€‚</p>
                                </div>
                            </div>
                            <div class="timeline-item">
                                <div class="timeline-connector"></div>
                                <div class="timeline-dot">12:20</div>
                                <div class="timeline-content">
                                    <h4 class="font-semibold text-lg text-gray-800">ã€äº¤é€šã€‘<span class="line-skyliner">Skyliner</span> â†’ æ—¥æš®é‡Œ</h4>
                                    <p class="text-sm font-medium text-[#189AB4]">ä¹˜è»Šæ™‚é–“ç´„ 40 åˆ†é˜ã€‚</p>
                                </div>
                            </div>
                            <div class="timeline-item">
                                <div class="timeline-connector"></div>
                                <div class="timeline-dot">13:05</div>
                                <div class="timeline-content">
                                    <h4 class="font-semibold text-lg text-gray-800">ã€äº¤é€šã€‘<span class="line-jr">JR å±±æ‰‹ç·š</span> â†’ æ–°å®¿</h4>
                                    <p class="text-sm font-medium text-[#189AB4]">æ—¥æš®é‡Œç«™æ›ä¹˜ï¼Œä¹˜è»Šæ™‚é–“ç´„ 25 åˆ†é˜ã€‚</p>
                                </div>
                            </div>
                            <div class="timeline-item">
                                <div class="timeline-connector"></div>
                                <div class="timeline-dot">13:45</div>
                                <div class="timeline-content">
                                    <h4 class="font-semibold text-lg text-gray-800">åˆé¤: é‡‘è‰²ä¸å¦‚æ­¸</h4>
                                    <p class="text-gray-600">çœŸé¯›èˆ‡è›¤èœŠé¹½å‘³æ‹‰éºµã€‚å¾æ–°å®¿ç«™æ­¥è¡Œå‰å¾€ã€‚</p>
                                </div>
                            </div>
                            <div class="timeline-item">
                                <div class="timeline-connector"></div>
                                <div class="timeline-dot">14:30</div>
                                <div class="timeline-content">
                                    <h4 class="font-semibold text-lg text-gray-800">å‰å¾€ Airbnb & Check-in</h4>
                                    <p class="text-gray-600">æ­¥è¡Œè‡³ Airbnb (6-chÅme-4-19 Shinjuku)ã€‚</p>
                                </div>
                            </div>
                            <div class="timeline-item">
                                <div class="timeline-connector"></div>
                                <div class="timeline-dot">15:30</div>
                                <div class="timeline-content">
                                    <h4 class="font-semibold text-lg text-gray-800">æ–°å®¿å¾¡è‹‘ / æ–°å®¿é€›è¡—</h4>
                                    <p class="text-gray-600">æ–°å®¿å¾¡è‹‘ (16:30 æœ€å¾Œå…¥å ´)ã€ä¼Šå‹¢ä¸¹ã€Lumine EST ç­‰ã€‚</p>
                                </div>
                            </div>
                            <div class="timeline-item">
                                <div class="timeline-dot">18:30</div>
                                <div class="timeline-content">
                                    <h4 class="font-semibold text-lg text-gray-800">æ–°å®¿ä¹‹å¤œ</h4>
                                    <p class="text-gray-600">æ™šé¤ (ç‡’è‚‰å–9?)ã€æ€å‡ºæ©«ä¸ã€æ­Œèˆä¼ç”ºã€‚</p>
                                </div>
                            </div>
                        </div>
                        <div class="chart-container h-[350px] max-h-[400px]">
                            <canvas id="day1Chart"></canvas>
                            <p class="text-center text-sm text-gray-600 mt-2">Day 1 æ™‚é–“åˆ†é… (å°æ™‚)</p>
                            <div id="day1Legend" class="chart-legend-bottom"></div>
                        </div>
                    </div>
                </div>

                
                <div id="day2" class="tab-content bg-white p-6 md:p-8 rounded-lg shadow-lg hidden">
                    <h3 class="text-2xl font-bold text-[#05445E] mb-4 border-b-2 border-[#189AB4] pb-2">12/18 (å››) - Day 2: æ·ºè‰, æ™´ç©ºå¡”, ç§‹è‘‰åŸ</h3>
                    
                    <div class="bg-[#D4F1F4] p-4 rounded-lg mb-6 shadow-inner">
                        <h4 class="font-bold text-lg text-[#05445E] mb-2">â­ ç•¶æ—¥å¾…è™•ç†äº‹é …/æé†’</h4>
                        <div class="grid grid-cols-1 sm:grid-cols-2 gap-x-4 gap-y-2 text-gray-700 ml-4">
                            <div>
                                <strong class="text-[#05445E] block mb-1">é è¨‚ & è²»ç”¨</strong>
                                <ul class="list-disc list-inside space-y-1 ml-4 text-sm">
                                    <li>æ±äº¬æ™´ç©ºå¡”åŸé–€ç¥¨ï¼Œéœ€åœ¨ <strong class="text-red-600">3å¤©å‰è¨‚ç¥¨</strong>ã€‚</li>
                                </ul>
                            </div>
                            <div>
                                <strong class="text-[#05445E] block mb-1">è·¯ç·š & æ¡è²·</strong>
                                <ul class="list-disc list-inside space-y-1 ml-4 text-sm">
                                    <li>è—¥å¦æ¡è²·: é˜¿ç¾æ©«ä¸ OS drug/å¤§åœ‹è—¥å¦æœ€ä¾¿å®œã€‚é™ç¾é‡‘/ä¸å¯é€€ç¨…ã€‚</li>
                                </ul>
                            </div>
                        </div>
                    </div>

                    <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                        <div class="md:col-span-2">
                            <div class="timeline-item">
                                <div class="timeline-connector"></div>
                                <div class="timeline-dot">09:30</div>
                                <div class="timeline-content">
                                    <h4 class="font-semibold text-lg text-gray-800">å‡ºé–€ & å‰å¾€æ·ºè‰</h4>
                                    <p class="text-sm font-medium text-[#189AB4] mt-1">ã€äº¤é€šã€‘<span class="line-marunouchi">ä¸¸ä¹‹å…§ç·š(M)</span> [æ–°å®¿ä¸‰ä¸ç›®] â†’ [èµ¤å‚è¦‹é™„] è½‰ <span class="line-ginza">éŠ€åº§ç·š(G)</span> â†’ [æ·ºè‰]ã€‚</p>
                                </div>
                            </div>
                            <div class="timeline-item">
                                <div class="timeline-connector"></div>
                                <div class="timeline-dot">10:30</div>
                                <div class="timeline-content">
                                    <h4 class="font-semibold text-lg text-gray-800">æ·ºè‰å¯º (é›·é–€ã€ä»²è¦‹ä¸–é€š)</h4>
                                    <p class="text-gray-600">åƒè§€ã€é€›å•†åº—è¡—ã€‚</p>
                                </div>
                            </div>
                            <div class="timeline-item">
                                <div class="timeline-connector"></div>
                                <div class="timeline-dot">12:00</div>
                                <div class="timeline-content">
                                    <h4 class="font-semibold text-lg text-gray-800">æ±äº¬æ™´ç©ºå¡”åŸ (åˆé¤)</h4>
                                    <p class="text-gray-600">æ­¥è¡Œæˆ–æ­æ±æ­¦ç·šå‰å¾€ã€‚åœ¨ Solamachi äº«ç”¨åˆé¤ã€‚</p>
                                </div>
                            </div>
                            <div class="timeline-item">
                                <div class="timeline-connector"></div>
                                <div class="timeline-dot">13:45</div>
                                <div class="timeline-content">
                                    <h4 class="font-semibold text-lg text-gray-800">ä¸Šé‡ (é˜¿ç¾æ©«ä¸)</h4>
                                    <p class="text-sm font-medium text-[#189AB4] mt-1">ã€äº¤é€šã€‘æ™´ç©ºå¡” â†’ ä¸Šé‡ (ç¶“åŠè—é–€ç·šè½‰<span class="line-ginza">éŠ€åº§ç·š(G)</span>)ã€‚</p>
                                    <p class="text-gray-600">é€›é˜¿ç¾æ©«ä¸ã€æº–å‚™æ¡è²·è—¥å¦ã€‚</p>
                                </div>
                            </div>
                            <div class="timeline-item">
                                <div class="timeline-dot">16:00</div>
                                <div class="timeline-content">
                                    <h4 class="font-semibold text-lg text-gray-800">ç§‹è‘‰åŸ</h4>
                                    <p class="text-gray-600">å¾å¾¡å¾’ç”ºæ­¥è¡Œ 10-15 åˆ†é˜å³é”ç§‹è‘‰åŸã€‚</p>
                                    <p class="text-gray-600">æ™šé¤ã€‚æ™šä¸Šæ­ä¹˜ Metro æ–°å®¿ç·šè¿”å›ã€‚</p>
                                </div>
                            </div>
                        </div>
                        <div class="chart-container h-[350px] max-h-[400px]">
                            <canvas id="day2Chart"></canvas>
                            <p class="text-center text-sm text-gray-600 mt-2">Day 2 æ™‚é–“åˆ†é… (å°æ™‚)</p>
                            <div id="day2Legend" class="chart-legend-bottom"></div>
                        </div>
                    </div>
                </div>

                
                <div id="day3" class="tab-content bg-white p-6 md:p-8 rounded-lg shadow-lg hidden">
                    <h3 class="text-2xl font-bold text-[#05445E] mb-4 border-b-2 border-[#189AB4] pb-2">12/19 (äº”) - Day 3: åŸå®¿ & æ¾€è°·æ—¥è½</h3>
                    
                    <div class="bg-[#D4F1F4] p-4 rounded-lg mb-6 shadow-inner">
                        <h4 class="font-bold text-lg text-[#05445E] mb-2">â­ ç•¶æ—¥å¾…è™•ç†äº‹é …/æé†’</h4>
                        <div class="grid grid-cols-1 sm:grid-cols-2 gap-x-4 gap-y-2 text-gray-700 ml-4">
                            <div>
                                <strong class="text-[#05445E] block mb-1">é è¨‚ & è²»ç”¨</strong>
                                <ul class="list-disc list-inside space-y-1 ml-4 text-sm">
                                    <li>Shibuya Sky é–€ç¥¨ã€‚ å‹™å¿…åœ¨ <strong class="text-red-600">12/4 11pm æº–æ™‚æ¶ 16:00 å ´æ¬¡</strong>ã€‚</li>
                                </ul>
                            </div>
                            <div>
                                <strong class="text-[#05445E] block mb-1">è·¯ç·š & æé†’</strong>
                                <ul class="list-disc list-inside space-y-1 ml-4 text-sm">
                                    <li>åŸå®¿æ¢ç´¢è·¯ç·šéœ€ç¢ºèªã€‚</li>
                                </ul>
                            </div>
                        </div>
                    </div>

                    
                    <div class="bg-gray-100 p-4 rounded-lg mb-6 shadow-inner">
                        <h4 class="font-bold text-lg text-[#05445E] mb-3">ğŸ—ºï¸ åŸå®¿/æ¾€è°·æ¢ç´¢åœ°åœ–é€£çµ</h4>
                        <div class="flex flex-wrap gap-4">
                            <a href="https://maps.app.goo.gl/nWfSHtNiTzEonYCSA" target="_blank" class="text-blue-600 hover:text-blue-800 font-medium px-3 py-1 bg-white rounded-md border border-blue-200 text-sm shadow-sm">
                                åˆ·é‡ç‰ˆ (A)
                            </a>
                            <a href="https://maps.app.goo.gl/2GjStudjasFZ8D6m9" target="_blank" class="text-blue-600 hover:text-blue-800 font-medium px-3 py-1 bg-white rounded-md border border-blue-200 text-sm shadow-sm">
                                Geminiç‰ˆ (B)
                            </a>
                        </div>
                    </div>


                    <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                        <div class="md:col-span-2">
                            <div class="timeline-item">
                                <div class="timeline-connector"></div>
                                <div class="timeline-dot">09:30</div>
                                <div class="timeline-content">
                                    <h4 class="font-semibold text-lg text-gray-800">å‡ºé–€ & å‰å¾€åŸå®¿</h4>
                                    <p class="text-sm font-medium text-[#189AB4] mt-1">ã€äº¤é€šã€‘<span class="line-fukutoshin">å‰¯éƒ½å¿ƒç·š(F)</span> [æ–°å®¿ä¸‰ä¸ç›®] ç›´é” [æ˜æ²»ç¥å®®å‰]ã€‚</p>
                                </div>
                            </div>
                            <div class="timeline-item">
                                <div class="timeline-connector"></div>
                                <div class="timeline-dot">10:00</div>
                                <div class="timeline-content">
                                    <h4 class="font-semibold text-lg text-gray-800">æ˜æ²»ç¥å®®</h4>
                                    <p class="text-gray-600">åƒæ‹œèˆ‡æ•£æ­¥ã€‚</p>
                                </div>
                            </div>
                            <div class="timeline-item">
                                <div class="timeline-connector"></div>
                                <div class="timeline-dot">11:00</div>
                                <div class="timeline-content">
                                    <h4 class="font-semibold text-lg text-gray-800">åŸå®¿ã€è¡¨åƒé“ã€è²“è¡— (å«åˆé¤)</h4>
                                    <p class="text-gray-600">4.5 å°æ™‚æ·±åº¦æ¢ç´¢ (ç«¹ä¸‹é€šã€è£åŸå®¿ç­‰)ã€‚</p>
                                </div>
                            </div>
                            <div class="timeline-item">
                                <div class="timeline-connector"></div>
                                <div class="timeline-dot">15:45</div>
                                <div class="timeline-content">
                                    <h4 class="font-semibold text-lg text-gray-800">æŠµé” Shibuya Sky</h4>
                                    <p class="text-gray-600">ç‚ºç¢ºä¿ 16:00 æº–æ™‚å…¥å ´ã€‚</p>
                                </div>
                            </div>
                            <div class="timeline-item">
                                <div class="timeline-connector"></div>
                                <div class="timeline-dot">16:00</div>
                                <div class="timeline-content">
                                    <h4 class="font-semibold text-lg text-gray-800">Shibuya Sky è§€æ™¯å°</h4>
                                    <p class="text-gray-600">è§€è³ 16:30 æ—¥è½æ™¯è§€ã€‚</p>
                                </div>
                            </div>
                            <div class="timeline-item">
                                <div class="timeline-dot">17:30</div>
                                <div class="timeline-content">
                                    <h4 class="font-semibold text-lg text-gray-800">æ¾€è°·ä¹‹å¤œ</h4>
                                    <p class="text-gray-600">æ¾€è°·åå­—è·¯å£ã€æ™šé¤ (å±…é…’å±‹?)ã€‚çµæŸå¾Œæ­ä¹˜<span class="line-fukutoshin">å‰¯éƒ½å¿ƒç·š(F)</span>è¿”å›ã€‚</p>
                                </div>
                            </div>
                        </div>
                        <div class="chart-container h-[350px] max-h-[400px]">
                            <canvas id="day3Chart"></canvas>
                            <p class="text-center text-sm text-gray-600 mt-2">Day 3 æ™‚é–“åˆ†é… (å°æ™‚)</p>
                            <div id="day3Legend" class="chart-legend-bottom"></div>
                        </div>
                    </div>
                </div>

                
                <div id="day4" class="tab-content bg-white p-6 md:p-8 rounded-lg shadow-lg hidden">
                    <h3 class="text-2xl font-bold text-[#05445E] mb-4 border-b-2 border-[#189AB4] pb-2">12/20 (å…­) - Day 4: æ±äº¬éµå¡” & å…­æœ¬æœ¨ä¹‹å¤œ</h3>
                    
                    <div class="bg-[#D4F1F4] p-4 rounded-lg mb-6 shadow-inner">
                        <h4 class="font-bold text-lg text-[#05445E] mb-2">â­ ç•¶æ—¥å¾…è™•ç†äº‹é …/æé†’</h4>
                        <div class="grid grid-cols-1 sm:grid-cols-2 gap-x-4 gap-y-2 text-gray-700 ml-4">
                            <div>
                                <strong class="text-[#05445E] block mb-1">é è¨‚ & è²»ç”¨</strong>
                                <ul class="list-disc list-inside space-y-1 ml-4 text-sm">
                                    <li>63 Angel è¡¨æ¼”å·²é ç´„ (20:00 å ´æ¬¡)ã€‚</li>
                                    <li>è¡¨æ¼”è²»ç”¨ (ç´„ Â¥8500)ã€‚</li>
                                </ul>
                            </div>
                            <div>
                                <strong class="text-[#05445E] block mb-1">è·¯ç·š & æé†’</strong>
                                <ul class="list-disc list-inside space-y-1 ml-4 text-sm">
                                    <li>æ™šé¤éœ€åœ¨ 19:45 å‰ç”¨å®Œï¼Œä»¥è¶•ä¸Šè¡¨æ¼”ã€‚</li>
                                    <li>æ«¸å‚é€šè–èª•é»ç‡ˆ 17:00 é–‹å§‹ã€‚</li>
                                </ul>
                            </div>
                        </div>
                    </div>

                    <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                        <div class="md:col-span-2">
                            <div class="timeline-item">
                                <div class="timeline-connector"></div>
                                <div class="timeline-dot">09:30</div>
                                <div class="timeline-content">
                                    <h4 class="font-semibold text-lg text-gray-800">å‡ºé–€ & å‰å¾€æ±äº¬éµå¡”</h4>
                                    <p class="text-sm font-medium text-[#189AB4] mt-1">ã€äº¤é€šã€‘<span class="line-oedo">éƒ½ç‡Ÿå¤§æ±Ÿæˆ¶ç·š(E)</span> [æ±æ–°å®¿] ç›´é” [èµ¤ç¾½æ©‹]ã€‚</p>
                                </div>
                            </div>
                            <div class="timeline-item">
                                <div class="timeline-connector"></div>
                                <div class="timeline-dot">10:15</div>
                                <div class="timeline-content">
                                    <h4 class="font-semibold text-lg text-gray-800">æ±äº¬éµå¡” + æ‹ç…§</h4>
                                    <p class="text-gray-600">ç™»å¡”æˆ–åœ¨ä¸‹æ–¹å…¬åœ’æ‹ç…§ã€‚</p>
                                </div>
                            </div>
                            <div class="timeline-item">
                                <div class="timeline-connector"></div>
                                <div class="timeline-dot">11:30</div>
                                <div class="timeline-content">
                                    <h4 class="font-semibold text-lg text-gray-800">éº»å¸ƒåç•ªå•†åº—è¡— (åˆé¤)</h4>
                                    <p class="text-gray-600">å¾éµå¡”æ­¥è¡Œ 15-20 åˆ†é˜ã€‚å“åšé¯›é­šç‡’ç­‰å°åƒã€‚</p>
                                </div>
                            </div>
                            <div class="timeline-item">
                                <div class="timeline-connector"></div>
                                <div class="timeline-dot">14:00</div>
                                <div class="timeline-content">
                                    <h4 class="font-semibold text-lg text-gray-800">å…­æœ¬æœ¨ä¹‹ä¸˜ (æ£®ç¾è¡“é¤¨ç­‰)</h4>
                                    <p class="text-gray-600">å¾éº»å¸ƒåç•ªæ­¥è¡Œç´„ 15 åˆ†é˜ã€‚</p>
                                </div>
                            </div>
                            <div class="timeline-item">
                                <div class="timeline-connector"></div>
                                <div class="timeline-dot">17:00</div>
                                <div class="timeline-content">
                                    <h4 class="font-semibold text-lg text-gray-800">æ«¸å‚é€šè–èª•é»ç‡ˆ</h4>
                                    <p class="text-gray-600">æ¬£è³ 17:00 é–‹å§‹çš„é»ç‡ˆèˆ‡è”¦å±‹æ›¸åº—ã€‚</p>
                                </div>
                            </div>
                            <div class="timeline-item">
                                <div class="timeline-connector"></div>
                                <div class="timeline-dot">18:00</div>
                                <div class="timeline-content">
                                    <h4 class="font-semibold text-lg text-gray-800">æ™šé¤ (å…­æœ¬æœ¨å‘¨é‚Š)</h4>
                                    <p class="text-gray-600">éœ€é ç•™å……è£•æ™‚é–“ï¼Œ19:45 å‰ç”¨å®Œã€‚</p>
                                </div>
                            </div>
                            <div class="timeline-item">
                                <div class="timeline-connector"></div>
                                <div class="timeline-dot">20:00</div>
                                <div class="timeline-content">
                                    <h4 class="font-semibold text-lg text-gray-800">63 Angel å¤œç¸½æœƒè¡¨æ¼”</h4>
                                    <p class="text-gray-600">å·²é ç´„ 20:00 - 22:00 å ´æ¬¡ã€‚</p>
                                </div>
                            </div>
                            <div class="timeline-item">
                                <div class="timeline-dot">22:00</div>
                                <div class="timeline-content">
                                    <h4 class="font-semibold text-lg text-gray-800">è¿”å› Airbnb</h4>
                                    <p class="text-sm font-medium text-[#189AB4] mt-1">ã€äº¤é€šã€‘<span class="line-oedo">éƒ½ç‡Ÿå¤§æ±Ÿæˆ¶ç·š(E)</span> [å…­æœ¬æœ¨] ç›´é” [æ±æ–°å®¿]ã€‚</p>
                                </div>
                            </div>
                        </div>
                        <div class="chart-container h-[350px] max-h-[400px]">
                            <canvas id="day4Chart"></canvas>
                            <p class="text-center text-sm text-gray-600 mt-2">Day 4 æ™‚é–“åˆ†é… (å°æ™‚)</p>
                            <div id="day4Legend" class="chart-legend-bottom"></div>
                        </div>
                    </div>
                </div>

                
                <div id="day5" class="tab-content bg-white p-6 md:p-8 rounded-lg shadow-lg hidden">
                    <h3 class="text-2xl font-bold text-[#05445E] mb-4 border-b-2 border-[#189AB4] pb-2">12/21 (æ—¥) - Day 5: ç¯‰åœ°, éŠ€åº§ & è¿”ç¨‹</h3>
                    
                    <div class="bg-red-100 p-4 rounded-lg mb-6 shadow-inner border-l-4 border-red-500">
                        <h4 class="font-bold text-lg text-red-700 mb-2">ğŸš¨ æ¥µåº¦å€‰ä¿ƒé¢¨éšªæé†’ (å¿…è®€)</h4>
                        <div class="grid grid-cols-1 sm:grid-cols-2 gap-x-4 gap-y-2 text-gray-700 ml-4">
                            <div>
                                <strong class="text-red-700 block mb-1">é¢¨éšªæ‘˜è¦</strong>
                                <ul class="list-disc list-inside space-y-1 ml-4 text-sm">
                                    <li>ç¯‰åœ°é«”é©—ä¸è¶³: 10:10 æŠµé”éŒ¯éç†±é¬§æ™‚æ®µï¼Œè¨±å¤šåº—å®¶ 13:00 é—œé–€ã€‚</li>
                                    <li>éŠ€åº§è³¼ç‰©ä¸è¶³: å¯¦éš›åƒ…ç´„ 75 åˆ†é˜å¿«é–ƒæ™‚é–“ã€‚</li>
                                </ul>
                            </div>
                            <div>
                                <strong class="text-red-700 block mb-1">å»ºè­°å°ç­–</strong>
                                <ul class="list-disc list-inside space-y-1 ml-4 text-sm">
                                    <li>å¼·çƒˆå»ºè­°: è«‹å°‡å‡ºé–€æ™‚é–“ææ—©åˆ° <strong class="text-red-600">08:30</strong>ï¼Œä»¥ç¢ºä¿é«”é©—å“è³ªã€‚</li>
                                </ul>
                            </div>
                        </div>
                    </div>

                    <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                        <div class="md:col-span-2">
                            <div class="timeline-item">
                                <div class="timeline-connector"></div>
                                <div class="timeline-dot">09:30</div>
                                <div class="timeline-content">
                                    <h4 class="font-semibold text-lg text-gray-800">Check out & å‰å¾€éŠ€åº§</h4>
                                    <p class="text-sm font-medium text-[#189AB4] mt-1">ã€äº¤é€šã€‘<span class="line-marunouchi">ä¸¸ä¹‹å…§ç·š(M)</span> [æ–°å®¿ä¸‰ä¸ç›®] ç›´é” [éŠ€åº§]ã€‚</p>
                                </div>
                            </div>
                            <div class="timeline-item">
                                <div class="timeline-connector"></div>
                                <div class="timeline-dot">09:55</div>
                                <div class="timeline-content">
                                    <h4 class="font-semibold text-lg text-gray-800">éŠ€åº§ç«™å¯„å­˜è¡Œæ</h4>
                                    <p class="text-gray-600">åˆ©ç”¨ç«™å…§ç½®ç‰©æ«ƒã€‚</p>
                                </div>
                            </div>
                            <div class="timeline-item">
                                <div class="timeline-connector"></div>
                                <div class="timeline-dot">10:10</div>
                                <div class="timeline-content">
                                    <h4 class="font-semibold text-lg text-gray-800">ç¯‰åœ°å ´å¤–å¸‚å ´ (æ—©åˆé¤)</h4>
                                    <p class="text-gray-600">æ­¥è¡Œå‰å¾€ã€‚è«‹æŠŠæ¡æ™‚é–“ã€‚</p>
                                </div>
                            </div>
                            <div class="timeline-item">
                                <div class="timeline-connector"></div>
                                <div class="timeline-dot">11:40</div>
                                <div class="timeline-content">
                                    <h4 class="font-semibold text-lg text-gray-800">éŠ€åº§é€›è¡— (å¿«é–ƒ)</h4>
                                    <p class="text-gray-600">æ­¥è¡Œè¿”å›éŠ€åº§ï¼Œç´„ 75 åˆ†é˜è³¼ç‰©æ™‚é–“ã€‚</p>
                                </div>
                            </div>
                            <div class="timeline-item">
                                <div class="timeline-connector"></div>
                                <div class="timeline-dot">12:55</div>
                                <div class="timeline-content">
                                    <h4 class="font-semibold text-lg text-gray-800">è¿”å›é ˜å–è¡Œæ</h4>
                                    <p class="text-gray-600">éŠ€åº§ç«™å–å›è¡Œæã€‚</p>
                                </div>
                            </div>
                            <div class="timeline-item">
                                <div class="timeline-connector"></div>
                                <div class="timeline-dot">13:10</div>
                                <div class="timeline-content">
                                    <h4 class="font-semibold text-lg text-gray-800">éŠ€åº§ â†’ äº¬æˆä¸Šé‡ç«™</h4>
                                    <p class="text-sm font-medium text-[#189AB4] mt-1">ã€äº¤é€šã€‘<span class="line-ginza">éŠ€åº§ç·š(G)</span>ç›´é”ä¸Šé‡ï¼Œæ­¥è¡Œè‡³äº¬æˆä¸Šé‡ç«™ã€‚</p>
                                </div>
                            </div>
                            <div class="timeline-item">
                                <div class="timeline-connector"></div>
                                <div class="timeline-dot">13:40</div>
                                <div class="timeline-content">
                                    <h4 class="font-semibold text-lg text-gray-800">æ­ä¹˜ <span class="line-skyliner">Skyliner</span> å‰å¾€æˆç”°æ©Ÿå ´</h4>
                                    <p class="text-gray-600">å»ºè­°æ­ä¹˜ 13:40 ç­æ¬¡ã€‚</p>
                                </div>
                            </div>
                            <div class="timeline-item">
                                <div class="timeline-dot">~14:25</div>
                                <div class="timeline-content">
                                    <h4 class="font-semibold text-lg text-gray-800">æŠµé”æˆç”°æ©Ÿå ´ (NRT T1)</h4>
                                    <p class="text-gray-600">æ™‚é–“å……è£•ï¼Œå¯è¾¦ç†å ±åˆ°ã€å®‰æª¢ã€é€›å…ç¨…åº—ã€‚</p>
                                </div>
                            </div>

                            <div class="mt-8 pt-4 border-t-2 border-[#D4F1F4]">
                                <h3 class="text-2xl font-bold text-[#05445E] mb-4">æ©Ÿå ´ã€Œé»ƒé‡‘3å°æ™‚ã€ (14:25 - 17:15)</h3>
                                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                                    <div>
                                        <h4 class="text-xl font-semibold text-[#189AB4] mb-3">ğŸ” 1. å‡ºå¢ƒå‰ï¼šæœ€å¾Œçš„ç¾é£Ÿ (T1 4F/5F)</h4>
                                        <ul class="list-disc list-inside text-gray-700 space-y-1 ml-4">
                                            <li>ç¯‰åœ°ã™ã—å¥½: æ­£çµ±æ±Ÿæˆ¶å‰å£½å¸ã€‚</li>
                                            <li>è‚‰æ–™ç†ã‚„ãã™ãã‚„ã‚“ã¾: é«˜å“è³ªå’Œç‰›å£½å–œç‡’ã€‚</li>
                                            <li>ã ã—èŒ¶æ¼¬ã‘ãˆã‚“: æ¸…çˆ½çš„èŒ¶æ³¡é£¯ã€‚</li>
                                        </ul>
                                    </div>
                                    <div>
                                        <h4 class="text-xl font-semibold text-[#189AB4] mb-3">ğŸ›ï¸ 2. å‡ºå¢ƒå¾Œï¼šå…ç¨…ä¼´æ‰‹ç¦® (T1 å…ç¨…å€)</h4>
                                        <ul class="list-disc list-inside text-gray-700 space-y-1 ml-4">
                                            <li>NewYork Perfect Cheese: æ±äº¬è»Šç«™æ’éšŠä¹‹ç‹ã€‚</li>
                                            <li>PRESS BUTTER SAND: ç„¦ç³–å¥¶æ²¹å¤¾å¿ƒé¤…ã€‚</li>
                                            <li>The Maple mania: äººæ°£é¤…ä¹¾ã€‚</li>
                                            <li>ROYCE' å·§å…‹åŠ›: ç”Ÿå·§å…‹åŠ›ã€æ´‹èŠ‹ç‰‡ç­‰ã€‚</li>
                                        </ul>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="chart-container h-[350px] max-h-[400px]">
                            <canvas id="day5Chart"></canvas>
                            <p class="text-center text-sm text-gray-600 mt-2">Day 5 æ™‚é–“åˆ†é… (å°æ™‚)</p>
                            <div id="day5Legend" class="chart-legend-bottom"></div>
                        </div>
                    </div>
                </div>
            </div>
        </section>

    </div>

    <script>
        
        
        
        
        
        

        
        const tabContainer = document.getElementById('tabs-container');
        const tabButtons = tabContainer.querySelectorAll('.tab-btn');
        const tabContents = document.querySelectorAll('.tab-content');
        // This will be set after charts are created and is safe to consult in the click handler
        let chartMap = {};

        tabButtons.forEach(button => {
            button.addEventListener('click', () => {
                
                tabButtons.forEach(btn => btn.classList.remove('active'));
                
                button.classList.add('active');
                
                
                const targetTab = button.getAttribute('data-tab');
                
                
                tabContents.forEach(content => {
                    if (content.id === targetTab) {
                        content.classList.remove('hidden');
                    } else {
                        content.classList.add('hidden');
                    }
                });
                // Resize/update visible chart so Chart.js renders correctly after changing visibility
                if (chartMap[targetTab]) {
                    setTimeout(() => {
                        try {
                            chartMap[targetTab].resize();
                            chartMap[targetTab].update();
                        } catch (e) {
                            // ignore errors during early load
                        }
                    }, 120);
                }
            });
        });

        
        function getLegendPosition() {
            return window.innerWidth <= 640 ? 'bottom' : 'right';
        }

        const commonChartOptions = {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
                legend: {
                    /* UI Refinement: å°‡åœ–ä¾‹ç§»è‡³å³å´ä»¥é¿å…æ–‡å­—æˆªæ–· */
                    position: getLegendPosition(), 
                    align: 'center',
                    // On small screens, we will hide Chart.js legend (and use HTML legend). The display flag is toggled in toggleLegendDisplay.
                    display: window.innerWidth > 640,
                    labels: {
                        font: {
                            family: "'Inter', 'Noto Sans TC', sans-serif"
                        },
                        boxWidth: 8,
                        usePointStyle: true,
                        padding: 10
                    }
                },
                tooltip: {
                    callbacks: {
                        title: function(tooltipItems) {
                            
                            const item = tooltipItems[0];
                            
                            let label = item.chart.data.labels[item.dataIndex];
                            
                            if (Array.isArray(label)) {
                              
                              return label.join(' ');
                            } else {
                              
                              return label;
                            }
                        }
                    }
                }
            }
        };

        const chartColors = ['#05445E', '#189AB4', '#75E6DA', '#D4F1F4'];

        
        
        
        
        
        const ctxDay1 = document.getElementById('day1Chart').getContext('2d');
        const day1Chart = new Chart(ctxDay1, {
            type: 'doughnut',
            data: {
                labels: ['æ©Ÿå ´äº¤é€š', 'Check-in & ç·©è¡', 'é¤é£²', 'æ–°å®¿æ¢ç´¢'],
                datasets: [{
                    data: [2.5, 1.5, 2, 4],
                    backgroundColor: chartColors,
                }]
            },
            options: commonChartOptions
        });
        
        const ctxDay2 = document.getElementById('day2Chart').getContext('2d');
        const day2Chart = new Chart(ctxDay2, {
            type: 'doughnut',
            data: {
                labels: ['äº¤é€š', ['æ·ºè‰ & æ™´ç©ºå¡”', 'è§€å…‰'], 'ä¸Šé‡ & ç§‹è‘‰åŸ', 'é¤é£²'],
                datasets: [{
                    data: [2, 3.5, 4.5, 2],
                    backgroundColor: chartColors,
                }]
            },
            options: commonChartOptions
        });

        const ctxDay3 = document.getElementById('day3Chart').getContext('2d');
        const day3Chart = new Chart(ctxDay3, {
            type: 'doughnut',
            data: {
                labels: ['äº¤é€š', 'æ˜æ²»ç¥å®®', ['åŸå®¿/è¡¨åƒé“', 'æ·±åº¦æ¢ç´¢'], 'Shibuya Sky', 'æ¾€è°· & æ™šé¤'],
                datasets: [{
                    data: [1, 1, 4.75, 1.5, 2.75],
                    backgroundColor: chartColors,
                }]
            },
            options: commonChartOptions
        });

        const ctxDay4 = document.getElementById('day4Chart').getContext('2d');
        const day4Chart = new Chart(ctxDay4, {
            type: 'doughnut',
            data: {
                labels: ['äº¤é€š', 'æ±äº¬éµå¡”', ['éº»å¸ƒåç•ª & åˆé¤'], 'å…­æœ¬æœ¨ Hills', 'è–èª•é»ç‡ˆ', 'æ™šé¤', '63 Angel è¡¨æ¼”'],
                datasets: [{
                    data: [1, 1.5, 2, 3.5, 1.5, 1.25, 2],
                    backgroundColor: ['#05445E', '#189AB4', '#75E6DA', '#D4F1F4', '#05445E', '#189AB4', '#75E6DA'],
                }]
            },
            options: commonChartOptions
        });
        
        const ctxDay5 = document.getElementById('day5Chart').getContext('2d');
        const day5Chart = new Chart(ctxDay5, {
            type: 'doughnut',
            data: {
                labels: ['Check-out & äº¤é€š', 'ç¯‰åœ° & éŠ€åº§', 'å‰å¾€æ©Ÿå ´', 'æ©Ÿå ´ç·©è¡'],
                datasets: [{
                    data: [1.25, 2.75, 1.5, 2.75],
                    backgroundColor: chartColors,
                }]
            },
            options: commonChartOptions
        });

        // Store charts for responsive updates
        const allCharts = [day1Chart, day2Chart, day3Chart, day4Chart, day5Chart];
        chartMap = { day1: day1Chart, day2: day2Chart, day3: day3Chart, day4: day4Chart, day5: day5Chart };

        // Update legend positions on resize to maintain good layout on mobile vs desktop
        function updateLegendPositions() {
            const pos = getLegendPosition();
            allCharts.forEach(c => {
                if (c && c.options && c.config) {
                    c.options.plugins.legend.position = pos;
                    c.options.plugins.legend.display = window.innerWidth > 640;
                    c.update();
                }
            });
            // Toggle or re-render HTML legends as needed
            toggleAllHtmlLegends();
        }

        function renderHtmlLegend(chart, containerId) {
            const container = document.getElementById(containerId);
            if (!container) return;
            container.innerHTML = '';
            const labels = chart.data.labels || [];
            const dataset = (chart.data.datasets && chart.data.datasets[0]) || { backgroundColor: [] };
            labels.forEach((lab, i) => {
                const labelText = Array.isArray(lab) ? lab.join(' ') : lab;
                const color = Array.isArray(dataset.backgroundColor) ? dataset.backgroundColor[i] : dataset.backgroundColor;
                const item = document.createElement('div');
                item.className = 'legend-item';
                const box = document.createElement('span');
                box.className = 'legend-box';
                box.style.backgroundColor = color || '#ccc';
                const labelSpan = document.createElement('span');
                labelSpan.textContent = labelText;
                item.appendChild(box);
                item.appendChild(labelSpan);
                container.appendChild(item);
            });
        }

        function toggleAllHtmlLegends() {
            const useHtmlLegend = window.innerWidth <= 640;
            const areas = ['day1', 'day2', 'day3', 'day4', 'day5'];
            areas.forEach(id => {
                const chart = chartMap[id];
                const legendContainer = document.getElementById(id + 'Legend');
                if (!chart || !legendContainer) return;
                if (useHtmlLegend) {
                    renderHtmlLegend(chart, id + 'Legend');
                } else {
                    legendContainer.innerHTML = '';
                }
            });
        }

        let resizeTimeout;
        window.addEventListener('resize', () => {
            clearTimeout(resizeTimeout);
            resizeTimeout = setTimeout(updateLegendPositions, 120);
        });

        // call once on load in case initial layout needs bottom legend on mobile
        updateLegendPositions();

    </script>
</body>
</html>